* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

/* THEME BACKGROUND */
.main-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #0d2a2a 0%, #006064 100%);
    color: white;
    padding: 20px 5%;
    position: relative;
    overflow-x: hidden;
}

/* HEADER STYLE */
/* MODERN HEADER & LOGO SCALING */
.header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    padding: 20px 0; /* Increased padding for more "breathing room" */
}

.logo-group { 
    display: flex; 
    align-items: center; 
    gap: 25px; 
}

.logo { 
    width: 120px;       /* Increased width for better visibility */
    height: auto;        /* Automatic height to keep the shield shape perfect */
    border-radius: 15px; 
    /* This adds a soft glow behind your logo shield */
    filter: drop-shadow(0 0 10px rgba(0, 210, 255, 0.3)); 
    transition: transform 0.3s ease, filter 0.3s ease;
}

.logo:hover {
    transform: scale(1.05); /* Logo grows slightly when hovered */
    filter: drop-shadow(0 0 20px rgba(0, 210, 255, 0.6)); /* Glow intensifies */
}

.brand-info h2 { 
    font-size: 2rem; 
    letter-spacing: 1px;
    font-weight: 700;
}

.brand-info p { 
    font-size: 1.1rem; 
    color: #b2ebf2; 
    margin-top: 4px;
}
.mentor-profile { display: flex; align-items: center; gap: 15px; text-align: right; }
.profile-img { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #00d2ff; }
.mentor-text p { font-size: 0.9rem; }
.mentor-text small { color: #00d2ff; }

/* HERO SECTION */
.hero { text-align: center; padding-top: 80px; }
.hero h1 { font-size: 3.5rem; letter-spacing: 2px; }
.subtitle { font-size: 1.2rem; color: #b2ebf2; margin-top: 10px; }

/* GLASS CARDS */
.course-grid {
    display: flex; justify-content: center; gap: 20px; margin-top: 50px; flex-wrap: wrap;
}
.glass-card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 30px; border-radius: 20px; width: 180px;
    text-align: center; transition: 0.3s; cursor: pointer;
}
.glass-card:hover { transform: translateY(-10px); background: rgba(255, 255, 255, 0.2); }
.glass-card i { font-size: 2rem; margin-bottom: 15px; color: #80deea; }

/* FOOTER */
.footer-info { position: absolute; bottom: 30px; left: 5%; font-size: 0.85rem; line-height: 1.6; color: #e0f7fa; }

/* CHAT WIDGET (AUTO POPUP) */
.chat-widget {
    position: fixed; bottom: 30px; right: 30px;
    width: 350px; height: 450px; background: #fff;
    border-radius: 15px; overflow: hidden; display: flex; flex-direction: column;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    transform: translateY(120%); transition: 0.5s ease; z-index: 1000;
}
.chat-widget.open { transform: translateY(0); }

.chat-header { background: #072e2e; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
.close-btn { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }

.chat-body { flex: 1; padding: 15px; background: #f4f7f6; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
.message { display: flex; gap: 10px; max-width: 85%; }
.message.tutor { align-self: flex-start; }
.message.student { align-self: flex-end; flex-direction: row-reverse; }

.bot-icon { background: #006064; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
.text { padding: 10px 15px; border-radius: 15px; font-size: 0.9rem; line-height: 1.4; }
.tutor .text { background: #e0e0e0; color: #333; }
.student .text { background: #006064; color: #fff; }

.chat-footer { padding: 10px; display: flex; gap: 5px; border-top: 1px solid #ddd; }
.chat-footer input { flex: 1; border: 1px solid #ccc; padding: 10px; border-radius: 20px; outline: none; }
.send-btn { background: #006064; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; }

// 1. GLOBAL VARIABLES (Declared outside functions so they don't reset)
let chatState = "asking_name"; 
let studentName = "";
let chatHistory = []; // Stores the conversation so the bot doesn't repeat itself

// 2. AUTOMATIC POP-UP
window.onload = () => {
    setTimeout(() => {
        document.getElementById('chat-widget').classList.add('open');
    }, 2000);
};

function toggleChat() {
    document.getElementById('chat-widget').classList.toggle('open');
}

function handleKeyPress(e) {
    if (e.key === 'Enter') sendMessage();
}

// 3. MAIN MESSAGE LOGIC
async function sendMessage() {
    const input = document.getElementById("userInput");
    const text = input.value.trim();
    if (!text) return;

    const chat = document.getElementById("chatArea");

    // Display student message
    const userMsg = document.createElement("div");
    userMsg.className = "message student";
    userMsg.innerHTML = `<div class="text">${text}</div>`;
    chat.appendChild(userMsg);
    input.value = "";
    chat.scrollTop = chat.scrollHeight;

    // --- LEAD CAPTURE & CONTEXT LOGIC ---
    if (chatState === "asking_name") {
        studentName = text;
        addTutorMessage(`Nice to meet you, ${studentName}! üòä Are you a student or a working professional?`);
        chatState = "asking_status";
    } 
    else if (chatState === "asking_status") {
        addTutorMessage(`Got it! And which course are you interested in: Alteryx, Power BI, Tableau, or Excel?`);
        chatState = "asking_course";
    }
    else if (chatState === "asking_course") {
        addTutorMessage(`Great choice! To send you the syllabus for ${text}, please share your **Email** or **WhatsApp number**.`);
        chatState = "asking_contact";
    }
    else if (chatState === "asking_contact") {
        addTutorMessage("Thank you! I've saved your details. You can now ask me any technical questions about these tools!");
        saveLead(studentName, text); 
        chatState = "chatting"; // Now the bot will use the AI for all future questions
    } 
    else {
        // Normal AI Chatbot Logic for technical questions
        await callAIBatch(text);
    }
}

// 4. HELPER FUNCTIONS
function addTutorMessage(text) {
    const chat = document.getElementById("chatArea");
    const tutorMsg = document.createElement("div");
    tutorMsg.className = "message tutor";
    tutorMsg.innerHTML = `<div class="bot-icon">ü§ñ</div><div class="text">${text}</div>`;
    chat.appendChild(tutorMsg);
    chat.scrollTop = chat.scrollHeight;
}

async function callAIBatch(question) {
    // Add current question to history
    chatHistory.push({ role: "user", content: question });

    try {
        const response = await fetch("https://ai-tutor-chatbot-ne61.onrender.com/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
                message: question,
                history: chatHistory // Sends the history to stop repetition
            })
        });
        
        const data = await response.json();
        chatHistory.push({ role: "assistant", content: data.reply });
        addTutorMessage(data.reply);
    } catch (error) {
        addTutorMessage("‚ö†Ô∏è Please wait a moment and try again.");
    }
}

async function saveLead(name, contact) {
    console.log("Lead Captured:", { name, contact });
    // This is where you connect to Google Sheets or your backend
}